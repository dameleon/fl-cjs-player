/*! fl-cjs-player // @version 0.1.0, @license MIT, @Author dameleon <dameleon@gmail.com> */
!function(t,e){"use strict";function i(t,e,s){if(!(this instanceof i))return new i(t,e,s);var r;this.state=A.INITIALIZE,this.setting=r=b(S,s),this.rootMcName=e,this.mc={},this._ns=L(r.namespaces),this.properties=w(this._ns.lib.properties,r.properties),this.canvas=E(t),"boolean"==typeof r.hd?(this.isHdMode=r.hd,this.isSdMode=!!r.hd):(this.isHdMode=P.isHighSpec,this.isSdMode=!P.isHighSpec),r.autostart&&this.load()}function s(t){if(this.state===A.INITIALIZE){var e=this,s=this.setting,r=this.properties,n=this._ns.lib[this.rootMcName],a=new i.Q(function(){var i=s.onload;e.stage=new e._ns.createjs.Stage(e.canvas),e.rootMc=e.mc["/"]=new n,e.state=A.LOADED,s.autostart&&e.play(),i&&i(),t&&t()});if(!n)throw new Error('Missing object error. Movieclip "'+e.rootMcName+'" does not exist in namespace "'+s.namespaces.lib+'".');this.state=A.LOADING,this.loadManifests(r.manifest,a.ing()),this.initViewer(a.ing())}}function r(t){var e,i,s,r,n=this.setting,a=this.properties,o=this.canvas;this.isHdMode?(e=a.width,i=a.height,s=e/n.dpr,s=i/n.dpr):(e=s=a.width/n.dpr,i=r=a.height/n.dpr),o.width=e,o.height=i,n.fullscreen?v(o,a.width,a.height,t):(o.style.width=s+"px",o.style.height=r+"px",t())}function n(t,e){var s=this.setting,r=this._ns.images;if(!t||t.length<1)return void e();var n=new i.AssetLoader({basePath:s.assetEndpoint});n.on("manifestsLoaded",function(t){for(var i,s=t.result,n=0;i=s[n];n++)r[i.id]=i;e()}),n.loadWithManifests(t)}function a(){if(this.state===A.LOADED){var t=this.setting,e=this.properties,i=this.stage,s=this.rootMc,r=this._ns.createjs.Ticker;this.isHdMode||(i.scaleX=i.scaleY=1/t.dpr),i.addChild(s),i.update(),this.startTicker(),r.setFPS(e.fps),r.addEventListener("tick",i),this.state=A.PLAYING}}function o(){this.state=A.STOPED,this.stage&&(this._ns.createjs.Ticker.removeEventListener("tick",this.stage),this.stage.clear()),this.setting.singlePlay&&this.stopTicker()}function h(){this.state===A.PLAYING&&(this.state=A.PAUSED,this._ns.createjs.Ticker.removeEventListener("tick",this.stage),this.setting.singlePlay&&this.stopTicker())}function l(){this.state===A.PAUSED&&(this.state=A.PLAYING,this._ns.createjs.Ticker.addEventListener("tick",this.stage),this.setting.singlePlay&&this.startTicker())}function c(t,i){var s=this.state;if(s===A.INITIALIZE||s===A.PAUSED)return null;if(t===e)throw new Error("Missing argument error. First argument is required");if("string"!=typeof t)throw new TypeError("Argument type error. First argument must be String");if(this.mc[t])return this.mc[t];var r="/",n=t.split(r),a=this.mc[r];t[0]===r?n.shift():t=r+t;for(var o,h=0;o=n[h];h++)if(a=a[o],!a)return console.warn("Undefined movieclip. [Path, Target movieclip, Target path]: ",t,a,o),null;return i&&(this.mc[t]=a),a}function u(t,e){e=e||"/";var i,s=this.getMovieClip(e);if(!s)throw new Error('Undefined MovieClip [name, path]: "'+t+'", "'+e+'"');return t=t||this.setting.apiKeyName,i=s[t],i?i:(console.warn("Undefined api [Target movieclip, Api key name]",s,t),null)}function d(t,e,i){var s,r=this.properties.manifest,n=/string|number/;if(!t||!e)throw new Error("Missing arguments error. First and second argument is required");if(!n.test(typeof t)||!n.test(typeof e))throw new Error("Argument type error, arguments must be String or Number");for(var a,o=0;a=r[o];o++)if(t===a.id){s=a;break}s||(s={id:t},r.push(s)),s.src=e,i&&(s.type=i)}function f(){this.properties.manifest||(this.properties.manifest=[]);for(var t,e=[].slice.call(arguments),i=this.properties.manifest,s=0;t=e[s];s++)i[i.length]=t}function p(){this.stop(),this.state=A.DESTROYED;var t,e,i,s=this._ns.images,r=this.properties.manifest,n=Object.keys(this);for(t=0;e=r[t];t++)s[e.id]=null,delete s[e.id];for(t=0;i=n[t];t++)"state"!==i&&(this[i]=null,delete this[i])}function g(){var t=this._ns.createjs.Ticker;t.getPaused()&&t.setPaused(!1)}function m(){this._ns.createjs.Ticker.setPaused(!0)}function v(e,i,s,r){function n(){var i=t.document.body,s=i.style,r=t.screen,n=h.max(r.availHeight,r.availWidth),u=s.height;i.addEventListener("touchstart",a),s.height=n+"px",t.scrollTo(0,1),setTimeout(function(){var r,n=e.style,h=t.innerWidth,d=t.innerHeight,f=d>h,p=h*l;i.removeEventListener("touchstart",a),s.height=u,r=f&&d>o&&d>p?p:d,n.width=r/l+"px",n.height=r+"px",c&&c()},200)}function a(t){return t.preventDefault(),t.stopPropagation(),!1}var o=372,h=t.Math,l=s/i,c=function(){c=null,r&&r()};t.addEventListener("orientationchange",function(){setTimeout(n,150)}),n()}function y(e){var i,s={};if(e=e.toLowerCase(),s.isAndroid=/android/.test(e),s.isIos=/ip(hone|od|ad)/.test(e),s.isChrome=/(chrome|crios)/.test(e),s.isAndroidBrowser=!s.chrome&&s.android&&/applewebkit/.test(e),s.isMobileSafari=!s.chrome&&s.ios&&/applewebkit/.test(e),s.versionString=s.androidBrowser||s.android&&s.chrome?e.match(/android\s(\S.*?)\;/):s.mobileSafari||s.ios&&s.chrome?e.match(/os\s(\S.*?)\s/):null,s.versionString=s.versionString?s.ios?s.versionString[1].replace("_","."):s.versionString[1]:null,s.version=i=s.versionString?s.versionString.split("."):null,s.isHighSpec=!1,i){for(var r=0,n=i.length;n>r;r++)i[r]=0|i[r];var a=i[0],o=i[1];if(s.android&&4===a&&o>2)s.isHighSpec=!0;else if(s.ios){var h=t.screen;Math.max(h.width,h.height)>416&&(s.isHighSpec=!0)}}return s}function w(t,i){var s={},r=Object.keys(t);i=i||{};for(var n,a=0;n=r[a];a++)s[n]=i[n]!==e?i[n]:t[n];return s}function E(e){var i;if(!e)throw new Error("Missing argument error. First argument is required");if("string"==typeof e){if(i=t.document.querySelector(e),!i)throw new Error('Element with the QuerySelector "'+e+'" does not exist')}else{if(!e.tagName||"canvas"!==e.tagName.toLowerCase())throw new TypeError("Argument type error. First Argument must be String or HTMLCanvasElement. "+Object.prototype.toString.call(e)+" given.");i=e}return i}function L(i){for(var s,r=Object.keys(i),n={},a=0;s=r[a];a++){if(t[i[s]]===e)throw new Error('Namespace "'+i[s]+'" does not exist in global object');n[s]=t[i[s]]}return n}function b(t,e){return i.extend({},t,e)}function T(){function t(t,e,s){var r=s[t],n=e[t],a=r&&typeof r||"",o=n&&typeof n||"";i.test(a)?(o!==a&&(e[t]="object"===a?{}:[]),T(e[t],r)):e[t]=r}if(arguments.length<2)return arguments[0];for(var e,i=/(object|array)/,s=[].slice.call(arguments),r=s.shift(),n=0;e=s[n];){var a=0;switch(typeof e){case"array":for(var o=e.length;o>a;a++)t(a,r,e);break;case"object":for(var h,l=Object.keys(e);h=l[a];a++)t(h,r,e)}n++}return r}var A={INITIALIZE:"initialize",LOADING:"loading",LOADED:"loaded",PLAYING:"playing",STOPED:"stoped",PAUSED:"paused",DESTROYED:"destroyed"},S={apiKeyName:"api",assetEndpoint:"",autostart:!1,dpr:1,fullscreen:!1,hd:null,maxConnections:5,namespaces:{lib:"lib",images:"images",createjs:"createjs"},onload:null,properties:null,singlePlay:!1},P=y(t.navigator.userAgent);i.STATES=A,i.env=P,i.extend=T,i.prototype={constructor:i,addManifestData:f,destroy:p,getApi:u,getMovieClip:c,initViewer:r,load:s,loadManifests:n,pause:h,play:a,resume:l,setManifestData:d,stop:o,startTicker:g,stopTicker:m},t.FlCjsPlayer=i,"process"in t||"function"!=typeof t.define||!t.define.amd||define([],function(){return i})}(this.self||global,void 0),function(t){"use strict";function e(t){this.setting=FlCjsPlayer.extend({},p,t),this.listeners={},this.queue={},this.tmpFiles={}}function i(t){var e=t.target;switch(e.removeEventListener("load",this),e.removeEventListener("error",this),t.type){case"load":var i=e.__qid;this._fire("fileLoaded",e),this._pushToTemporaryFileList(i,e),this._tickQueue(i);break;case"error":this._fire("error",e)}}function s(t){if(!Array.isArray(t))throw new Error("Argument type error. First argument must be Array");if(t.length<1)return console.warn("Passed through empty manifests"),void this._fire("manifestLoaded");var e,i=this,s=new FlCjsPlayer.Q(function(){i.handleManifestLoaded(e)});e=s.id,this.queue[e]=s;for(var r,n=0;r=t[n];n++)s.add(),this._loadItem(e,r)}function r(t,e){var i=new Image,s=(this.setting.basePath||"")+e.src;i.addEventListener("load",this),i.addEventListener("error",this),i.id=e.id,i.__qid=t,i.src=s}function n(t){var e=this.tmpFiles[t];this.tmpFiles[t]=null,delete this.tmpFiles[t],this.queue[t]=null,delete this.queue[t],this._fire("manifestsLoaded",e)}function a(t,e){var i=this._getListenerListByType(t);i.push(e)}function o(t,e){var i=this._getListenerListByType(t),s=i.indexOf(e);i.length<1||0>s||i.splice(s,1)}function h(){var t=[].slice.call(arguments),e=t.shift(),i=this._getListenerListByType(e);if(!(i.length<1)){var s=d(e);s.result=t.length>1?t:t[0];for(var r,n=0;r=i[n];n++)r.call(null,s)}}function l(t){return Array.isArray(this.listeners[t])?this.listeners[t]:this.listeners[t]=[]}function c(t,e){var i=Array.isArray(this.tmpFiles[t])?this.tmpFiles[t]:this.tmpFiles[t]=[];i[i.length]=e}function u(t){this.queue[t].tick()}function d(t){var e=f.createEvent("Event");return e.initEvent(t,!0,!0),e}var f=t.document;if(!t.FlCjsPlayer)throw new Error('"FlCjsPlayer" does not exist in global');var p={basePath:""};e.prototype={constructor:e,handleEvent:i,handleManifestLoaded:n,loadWithManifests:s,off:o,on:a,_fire:h,_getListenerListByType:l,_loadItem:r,_pushToTemporaryFileList:c,_tickQueue:u},t.FlCjsPlayer.AssetLoader=e}(this.self||global,void 0),function(t){"use strict";function e(t){this.id=o++,this.length=0,this.listeners=[],t&&this.addHandler(t)}function i(t){if("function"!=typeof t)throw new Error("Argument type error. First argument must be Function");this.listeners.push(t)}function s(t){var e=this;return this.length++,function(){var i=arguments;e.length--,t&&t.apply(null,i),e.length<1&&e.fire.apply(e,i)}}function r(){for(var t,e=arguments,i=this.listeners;t=i.shift();)t.apply(null,e)}function n(){this.length--,this.length<1&&this.fire.apply(this,arguments)}function a(){this.length++}if(!t.FlCjsPlayer)throw new Error('"FlCjsPlayer" does not exist in global');var o=0;e.prototype={constructor:e,add:a,addHandler:i,fire:r,ing:s,tick:n},t.FlCjsPlayer.Q=e}(this.self||global,void 0);
//# sourceMappingURL=fl-cjs-player.all.js.map